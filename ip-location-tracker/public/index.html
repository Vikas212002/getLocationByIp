<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Location from IP</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>

<h1>User Location Finder</h1>

<div>
  <p>Your public IP address: <span id="ip">Loading...</span></p>
  <button id="getLocation">Get Location Info</button>
</div>

<div id="result" style="margin-top:20px;"></div>

<script>
  async function getPublicIP() {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (err) {
      console.error('Failed to get public IP:', err);
      return null;
    }
  }

  async function getLocation(ip) {
    try {
      const response = await fetch(`/ip-location?ip=${encodeURIComponent(ip)}`);
      const data = await response.json();
      return data;
    } catch (err) {
      return { error: err.message };
    }
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const ipElem = document.getElementById('ip');
    const resultElem = document.getElementById('result');
    const getLocationBtn = document.getElementById('getLocation');

    const ip = await getPublicIP();
    if (ip) {
      ipElem.textContent = ip;
    } else {
      ipElem.textContent = 'Could not determine IP';
    }

    getLocationBtn.addEventListener('click', async () => {
      if (!ip) {
        resultElem.textContent = 'No IP address available.';
        return;
      }
      resultElem.textContent = 'Fetching location...';

      const locationData = await getLocation(ip);

      if (locationData.error) {
        resultElem.textContent = 'Error: ' + locationData.error;
      } else {
        resultElem.innerHTML = `<h3>Location Information</h3>
          <pre>${JSON.stringify(locationData, null, 2)}</pre>`;
      }
    });
  });
</script>

</body>
</html>
